<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Ladybug Hosting</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .admin-section { margin: 30px 0; padding: 20px; background: white; border-radius: 10px; }
        .admin-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .admin-table th, .admin-table td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        .admin-table th { background: #6c5ce7; color: white; }
        .admin-table tr:hover { background: #f5f5f5; }
        .tab-buttons { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-button { padding: 10px 20px; border: none; background: #ddd; cursor: pointer; border-radius: 5px; }
        .tab-button.active { background: #6c5ce7; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîê Admin Panel</h1>
            <div class="user-info">
                <a href="{{ url_for('admin_logout') }}" class="btn btn-small">Logout</a>
            </div>
        </header>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="tab-buttons">
            <button class="tab-button active" onclick="showTab('servers')">Servers</button>
            <button class="tab-button" onclick="showTab('users')">Users</button>
            <button class="tab-button" onclick="showTab('settings')">Settings</button>
            <button class="tab-button" onclick="showTab('transactions')">Transactions</button>
        </div>

        <!-- Servers Tab -->
        <div id="servers-tab" class="tab-content active">
            <div class="admin-section">
                <h2>Add New Server</h2>
                <form method="POST" action="{{ url_for('add_server') }}">
                    <div class="form-group">
                        <label>Server Name</label>
                        <input type="text" name="name" required class="form-control" placeholder="e.g., Server-US-01">
                    </div>
                    <div class="form-group">
                        <label>Server URL (SillyDev)</label>
                        <input type="text" name="server_url" required class="form-control" placeholder="https://client.sillydev.co.uk/server/...">
                    </div>
                    <div class="form-group">
                        <label>Server Type</label>
                        <select name="server_type" required class="form-control">
                            <option value="free">Free</option>
                            <option value="paid_5">Paid ($5)</option>
                            <option value="paid_10">Paid ($10)</option>
                            <option value="paid_15">Paid ($15)</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Server</button>
                </form>
            </div>

            <div class="admin-section">
                <h2>All Servers ({{ servers|length }})</h2>
                <table class="admin-table">
                    <thead>
                        <tr>
                                                        <th>ID</th>
                            <th>Name</th>
                            <th>URL</th>
                            <th>Type</th>
                            <th>Price</th>
                            <th>Status</th>
                            <th>Occupied By</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for server in servers %}
                        <tr>
                            <td>{{ server.id }}</td>
                            <td>{{ server.name }}</td>
                            <td><a href="{{ server.server_url }}" target="_blank">View</a></td>
                            <td>{{ server.server_type.replace('_', ' ').title() }}</td>
                            <td>${{ server.price }}</td>
                            <td>
                                {% if server.is_occupied %}
                                <span class="status-active">Occupied</span>
                                {% else %}
                                <span class="status-available">Available</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if server.occupied_by %}
                                    {% for user in users %}
                                        {% if user.id == server.occupied_by %}
                                            {{ user.username }}
                                        {% endif %}
                                    {% endfor %}
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td>
                                <form method="POST" action="{{ url_for('delete_server', server_id=server.id) }}" style="display:inline;">
                                    <button type="submit" class="btn btn-danger btn-small" onclick="return confirm('Delete this server?')">Delete</button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Users Tab -->
        <div id="users-tab" class="tab-content">
            <div class="admin-section">
                <h2>All Users ({{ users|length }})</h2>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Username</th>
                            <th>Coins</th>
                            <th>Server ID</th>
                            <th>Registered</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in users %}
                        <tr>
                            <td>{{ user.id }}</td>
                            <td>{{ user.username }}</td>
                            <td>{{ user.coins }}</td>
                            <td>
                                {% if user.server_id %}
                                    {{ user.server_id }}
                                {% else %}
                                    <span class="text-muted">None</span>
                                {% endif %}
                            </td>
                            <td>{{ user.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                            <td>
                                <form method="POST" action="{{ url_for('add_coins', user_id=user.id) }}" style="display:inline;">
                                    <input type="number" name="coins" placeholder="Coins" style="width: 80px; padding: 5px;" min="1" required>
                                    <button type="submit" class="btn btn-success btn-small">Add Coins</button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings-tab" class="tab-content">
            <div class="admin-section">
                <h2>Platform Settings</h2>
                <form method="POST" action="{{ url_for('update_settings') }}">
                    <div class="form-group">
                        <label>Logo URL</label>
                        <input type="text" name="logo_url" class="form-control" value="{{ settings.logo_url }}" placeholder="https://example.com/logo.png">
                        <small>Leave empty to use default text logo</small>
                    </div>
                    <div class="form-group">
                        <label>Background Song URL</label>
                        <input type="text" name="background_song_url" class="form-control" value="{{ settings.background_song_url }}" placeholder="https://example.com/song.mp3">
                        <small>Leave empty for no background music</small>
                    </div>
                    <div class="form-group">
                        <label>Coin Deduction Rate (per minute)</label>
                        <input type="number" name="coin_deduction_rate" class="form-control" value="{{ settings.coin_deduction_rate }}" min="1" required>
                        <small>How many coins to deduct per minute from active users</small>
                    </div>
                    <button type="submit" class="btn btn-primary">Update Settings</button>
                </form>
            </div>

            <div class="admin-section">
                <h2>System Statistics</h2>
                <div class="stats-grid">
                    <div class="stat-box">
                        <h3>Total Users</h3>
                        <p class="big-number">{{ users|length }}</p>
                    </div>
                    <div class="stat-box">
                        <h3>Total Servers</h3>
                        <p class="big-number">{{ servers|length }}</p>
                    </div>
                    <div class="stat-box">
                        <h3>Active Users</h3>
                        <p class="big-number">{{ users|selectattr('server_id')|list|length }}</p>
                    </div>
                    <div class="stat-box">
                        <h3>Available Servers</h3>
                        <p class="big-number">{{ servers|rejectattr('is_occupied')|list|length }}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transactions Tab -->
        <div id="transactions-tab" class="tab-content">
            <div class="admin-section">
                <h2>Recent Transactions (Last 50)</h2>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>User</th>
                            <th>Amount</th>
                            <th>Type</th>
                            <th>Server</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for transaction in transactions %}
                        <tr>
                            <td>{{ transaction.id }}</td>
                            <td>
                                {% for user in users %}
                                    {% if user.id == transaction.user_id %}
                                        {{ user.username }}
                                    {% endif %}
                                {% endfor %}
                            </td>
                            <td>{{ transaction.amount }} coins</td>
                            <td>
                                <span class="badge badge-{{ transaction.transaction_type }}">
                                    {{ transaction.transaction_type.title() }}
                                </span>
                            </td>
                            <td>
                                {% if transaction.server_id %}
                                    Server #{{ transaction.server_id }}
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td>{{ transaction.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }
    </script>
</body>
</html>

